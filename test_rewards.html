<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskHive - Rewards API Test</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-tasks"></i>
                <h1>TaskHive Rewards Test</h1>
            </div>
        </header>
        
        <main>
            <section class="content-section">
                <h2>Rewards API Integration Test</h2>
                <p>This page tests the integration between the TaskHive rewards system and the MongoDB backend.</p>
                <p>Check the console for detailed output of the tests.</p>
                
                <div id="test-controls">
                    <button id="run-all-tests" class="primary-button">Run All Tests</button>
                    <button id="view-rewards" class="secondary-button">View Rewards</button>
                </div>
                
                <div id="test-results-container"></div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2025 TaskHive. All rights reserved.</p>
        </footer>
    </div>
      <!-- Scripts -->
    <script src="auth.js"></script>
    <script src="rewards-system.js"></script>
    <script>        // Ensure RewardsSystem is properly initialized
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Ensuring RewardsSystem is available in window:', !!window.RewardsSystem);
            if (!window.RewardsSystem) {
                console.error('RewardsSystem not found in window, creating a backup');                window.RewardsSystem = {
                    // Simple stub implementation
                    getUserRewardsData: async () => ({ availableBalance: 0, totalEarned: 0, history: [] }),
                    calculateReward: async () => 5.00,
                    ensureRewardsModalExists: function() {
                        if (document.getElementById('rewards-modal')) return;
                        
                        // Create simple rewards modal
                        const modal = document.createElement('div');
                        modal.id = 'rewards-modal';
                        modal.className = 'modal';
                        modal.style.cssText = 'display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;';
                        
                        modal.innerHTML = `
                            <div class="modal-content" style="background: white; margin: 15% auto; padding: 20px; width: 70%; border-radius: 5px;">
                                <span class="close-modal" style="float: right; cursor: pointer; font-size: 24px;">&times;</span>
                                <h2>TaskHive Rewards</h2>
                                <div>
                                    <p>Total Earned: <span id="rewards-total-earned">$0.00</span></p>
                                    <p>Available Balance: <span id="rewards-available-balance">$0.00</span></p>
                                </div>
                                <div>
                                    <h3>Rewards History</h3>
                                    <div id="rewards-history">
                                        <div class="empty-history">No reward history yet.</div>
                                    </div>
                                </div>
                                <button class="close-modal">Close</button>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // Add close button handler
                        modal.querySelectorAll('.close-modal').forEach(btn => {
                            btn.addEventListener('click', () => {
                                modal.style.display = 'none';
                            });
                        });
                    },
                    showRewardsModal: async function() {
                        this.ensureRewardsModalExists();
                        
                        try {
                            // Get user data if authenticated
                            if (!Auth.isAuthenticated()) {
                                alert('Please log in to view rewards');
                                return;
                            }
                            
                            const userData = await this.getUserRewardsData();
                            document.getElementById('rewards-total-earned').textContent = `$${userData.totalEarned.toFixed(2)}`;
                            document.getElementById('rewards-available-balance').textContent = `$${userData.availableBalance.toFixed(2)}`;
                            
                            // Show the modal
                            document.getElementById('rewards-modal').style.display = 'flex';
                        } catch (error) {
                            console.error('Error showing rewards modal:', error);
                            alert('Error showing rewards: ' + error.message);
                        }
                    }
                };
            }
            
            // Add view rewards button handler
            const viewRewardsButton = document.getElementById('view-rewards');
            if (viewRewardsButton) {
                viewRewardsButton.addEventListener('click', async () => {
                    if (window.RewardsSystem) {
                        try {
                            await window.RewardsSystem.showRewardsModal();
                        } catch (error) {
                            console.error('Error showing rewards modal:', error);
                            alert('Error showing rewards: ' + error.message);
                        }
                    } else {
                        alert('RewardsSystem not available');
                    }
                });
            }
            
            // Add run all tests button handler
            const runAllTestsButton = document.getElementById('run-all-tests');
            if (runAllTestsButton) {
                runAllTestsButton.addEventListener('click', async () => {
                    // This will trigger the tests via the test_rewards_api.js script
                    const runTestsButton = document.getElementById('run-tests');
                    if (runTestsButton) {
                        runTestsButton.click();
                    } else {
                        alert('Run tests button not found');
                    }
                });
            }
        });
    </script>
    <script src="test_rewards_api.js"></script>
</body>
</html>
